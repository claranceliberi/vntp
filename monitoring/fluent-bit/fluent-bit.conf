[SERVICE]
Flush 5
Daemon off
Log_Level info
Parsers_File parsers.conf
HTTP_Server On
HTTP_Listen 0.0.0.0
HTTP_Port 2020

# Docker Container Logs - All VNTP services
[INPUT]
Name tail
Path /var/lib/docker/containers/*/*-json.log
Parser docker
Tag docker.*
Refresh_Interval 5
Read_from_Head true
Docker_Mode On
Docker_Mode_Flush 4

# Oracle Service Logs
[FILTER]
Name modify
Match docker.*oracle-service*
Add service.name oracle-service
Add service.version 1.0.0
Add service.type master-data-api
Add deployment.environment docker
Add log.source fluent-bit

# Imisanzu Service Logs
[FILTER]
Name modify
Match docker.*imisanzu-service*
Add service.name imisanzu-service
Add service.version 1.0.0
Add service.type aggregation-api
Add deployment.environment docker
Add log.source fluent-bit

# PostgreSQL Oracle Database Logs
[FILTER]
Name modify
Match docker.*postgres-oracle*
Add service.name postgres-oracle
Add service.version 15-alpine
Add service.type database
Add deployment.environment docker
Add log.source fluent-bit

# PostgreSQL Imisanzu Database Logs
[FILTER]
Name modify
Match docker.*postgres-imisanzu*
Add service.name postgres-imisanzu
Add service.version 15-alpine
Add service.type database
Add deployment.environment docker
Add log.source fluent-bit

# Redis Cache Logs
[FILTER]
Name modify
Match docker.*redis*
Add service.name redis
Add service.version 7-alpine
Add service.type cache
Add deployment.environment docker
Add log.source fluent-bit

# Prometheus Logs
[FILTER]
Name modify
Match docker.*prometheus*
Add service.name prometheus
Add service.version latest
Add service.type monitoring
Add deployment.environment docker
Add log.source fluent-bit

# Grafana Logs
[FILTER]
Name modify
Match docker.*grafana*
Add service.name grafana
Add service.version latest
Add service.type visualization
Add deployment.environment docker
Add log.source fluent-bit

# Parse JSON logs from Node.js services
[FILTER]
Name parser
Match docker.*oracle-service*
Key_Name log
Parser nodejs-json
Reserve_Data On

[FILTER]
Name parser
Match docker.*imisanzu-service*
Key_Name log
Parser nodejs-json
Reserve_Data On

# Add log level parsing
[FILTER]
Name modify
Match docker.*
Add log.level info
Add deployment.environment docker
Add log.source fluent-bit

[FILTER]
Name modify
Match docker.redis
Add service.name redis
Add service.version 7-alpine
Add deployment.environment docker
Add log.source fluent-bit

# Output to SigNoz OTEL Collector for Logs
[OUTPUT]
Name opentelemetry
Match docker.*
Host signoz-otel-collector
Port 4318
Logs_uri /v1/logs
Log_response_payload True
Tls off
Tls.verify off
Add_label source fluent-bit
Add_label environment docker

# Backup output to stdout for debugging
[OUTPUT]
Name stdout
Match docker.*